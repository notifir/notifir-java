/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/7.5/samples
 */

plugins {
  id 'java'
  id 'maven-publish'
  id 'fr.brouillard.oss.gradle.jgitver' version '0.9.1'
  id 'signing'
}

repositories {
  mavenCentral()
}

sourceCompatibility = 1.11
targetCompatibility = 1.11

jgitver {
  strategy 'MAVEN'
  nonQualifierBranches 'main'
  useDirty true
}

ext {
  okhttpVersion = '4.10.0'
  jacksonVersion = '2.13.3'
  hamcrestVersion = '2.2'
}

dependencies {
  implementation "com.squareup.okhttp3:okhttp:${okhttpVersion}"
  implementation "com.squareup.okhttp3:logging-interceptor:${okhttpVersion}"
  implementation "com.fasterxml.jackson.core:jackson-databind:${jacksonVersion}"
  implementation "org.apache.commons:commons-lang3:3.12.0"

  compileOnly 'org.projectlombok:lombok:1.18.24'
  annotationProcessor 'org.projectlombok:lombok:1.18.24'

  testCompileOnly 'org.projectlombok:lombok:1.18.24'
  testAnnotationProcessor 'org.projectlombok:lombok:1.18.24'

  testImplementation "org.mockito:mockito-core:4.6.1"
  testImplementation "com.squareup.okhttp3:mockwebserver:${okhttpVersion}"
  testImplementation "org.hamcrest:hamcrest-core:${hamcrestVersion}"
  testImplementation "org.hamcrest:hamcrest-library:${hamcrestVersion}"
  testImplementation "junit:junit:4.13.2"
}

task sourceJar(type: Jar) {
  from sourceSets.main.allJava
  archiveClassifier.set("sources")
}

task javadocJar(type: Jar, dependsOn: javadoc) {
  classifier = 'javadoc'
  from javadoc.destinationDir
}

publishing {
  repositories {
    maven {
      name = "OSSRH"
      if (project.hasProperty("release")) {
        url 'https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/'
      } else {
        url 'https://s01.oss.sonatype.org/content/repositories/snapshots'
      }
      credentials {
        username = System.getenv("OSSRH_USERNAME")
        password = System.getenv("OSSRH_TOKEN")
      }
    }
  }

  publications {
    maven(MavenPublication) {
      groupId = "io.github.notifir"
      artifactId = "notifir"

      pom {
        name = "notifir"
        description = "Java client library for Notifir"
        url = "https://github.com/notifir/notifir-java"
        licenses {
          license {
            name = 'MIT License'
            url = 'http://www.opensource.org/licenses/mit-license.php'
          }
        }
        developers {
          developer {
            id = "titenkov"
            name = "Pavel Titenkov"
            email = "pavel@titenkov.com"
          }
          developer {
            id = "katyaterletskaya"
            name = "Katya Kuzmenchuk"
            email = "kuzmenchukkatya@gmail.com"
          }
        }
        scm {
          connection = "scm:git:https://github.com/notifir/notifir-java.git"
          developerConnection = "scm:git:https://github.com/notifir/notifir-java.git"
          url = "https://github.com/notifir/notifir-java"
        }
      }
    }
  }
}

signing {
  useGpgCmd()
  sign publishing.publications.maven
}
